import{U as H}from"./user-7a776cf7.js";import{_ as P,H as X}from"./HeaderRouter-2e3b5674.js";import{g as M,f as g,e as C,h as q,o as x}from"./VRow-06a8dd11.js";import{m as I}from"./useRender-5142e326.js";import{h as G,a9 as K,aa as Q,ab as Y,r as y,c as ee,l as B,m as D,w as m,j as r,R as te,N as _,M as A,D as R,T as $}from"./index-47b4a022.js";import"./tag-35f47c51.js";function se(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",e=arguments.length>2?arguments[2]:void 0;return G()({name:e??K(Q(a.replace(/__/g,"-"))),props:{tag:{type:String,default:s},...I()},setup(t,n){let{slots:o}=n;return()=>{var u;return Y(t.tag,{class:[a,t.class],style:t.style},(u=o.default)==null?void 0:u.call(o))}}})}const ae=se("flex-grow-1","div","VSpacer");/*! maska v2.1.9 | (c) Alexander Shabunevich | Released under the MIT license */var ne=Object.defineProperty,le=(a,s,e)=>s in a?ne(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e,b=(a,s,e)=>(le(a,typeof s!="symbol"?s+"":s,e),e);const j={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class L{constructor(s={}){b(this,"opts",{}),b(this,"memo",new Map);const e={...s};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...j,...e.tokens};for(const t of Object.values(e.tokens))typeof t.pattern=="string"&&(t.pattern=new RegExp(t.pattern))}else e.tokens=j;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((t,n)=>t.length-n.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(s){return this.process(s,this.findMask(s))}unmasked(s){return this.process(s,this.findMask(s),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(s){const e=this.findMask(s);if(this.opts.mask==null||e==null)return!1;const t=this.process(s,e).length;return typeof this.opts.mask=="string"?t>=this.opts.mask.length:typeof this.opts.mask=="function"?t>=e.length:this.opts.mask.filter(n=>t>=n.length).length===this.opts.mask.length}findMask(s){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(s);const t=this.process(s,e.slice(-1).pop()??"",!1);return e.find(n=>this.process(s,n,!1).length>=t.length)??""}escapeMask(s){const e=[],t=[];return s.split("").forEach((n,o)=>{n==="!"&&s[o-1]!=="!"?t.push(o-t.length):e.push(n)}),{mask:e.join(""),escaped:t}}process(s,e,t=!0){var n;if(e==null)return s;const o=`value=${s},mask=${e},masked=${t?1:0}`;if(this.memo.has(o))return this.memo.get(o);const{mask:u,escaped:h}=this.escapeMask(e),c=[],v=this.opts.tokens!=null?this.opts.tokens:{},l=this.isReversed()?-1:1,i=this.isReversed()?"unshift":"push",d=this.isReversed()?0:u.length-1,Z=this.isReversed()?()=>p>-1&&f>-1:()=>p<u.length&&f<s.length,z=V=>!this.isReversed()&&V<=d||this.isReversed()&&V>=d;let T,E=-1,p=this.isReversed()?u.length-1:0,f=this.isReversed()?s.length-1:0;for(;Z();){const V=u.charAt(p),k=v[V],w=(k==null?void 0:k.transform)!=null?k.transform(s.charAt(f)):s.charAt(f);if(!h.includes(p)&&k!=null){if(w.match(k.pattern)!=null)c[i](w),k.repeated?(E===-1?E=p:p===d&&p!==E&&(p=E-l),d===E&&(p-=l)):k.multiple&&(p-=l),p+=l;else if(k.multiple){const F=((n=c[f-l])==null?void 0:n.match(k.pattern))!=null,O=u.charAt(p+l);F&&O!==""&&v[O]==null?(p+=l,f-=l):c[i]("")}else w===T?T=void 0:k.optional&&(p+=l,f-=l);f+=l}else t&&!this.isEager()&&c[i](V),w===V&&!this.isEager()?f+=l:T=V,this.isEager()||(p+=l);if(this.isEager())for(;z(p)&&(v[u.charAt(p)]==null||h.includes(p));)t?c[i](u.charAt(p)):u.charAt(p)===s.charAt(f)&&(f+=l),p+=l}return this.memo.set(o,c.join("")),this.memo.get(o)}}const J=a=>JSON.parse(a.replaceAll("'",'"')),W=(a,s={})=>{const e={...s};return a.dataset.maska!=null&&a.dataset.maska!==""&&(e.mask=oe(a.dataset.maska)),a.dataset.maskaEager!=null&&(e.eager=U(a.dataset.maskaEager)),a.dataset.maskaReversed!=null&&(e.reversed=U(a.dataset.maskaReversed)),a.dataset.maskaTokensReplace!=null&&(e.tokensReplace=U(a.dataset.maskaTokensReplace)),a.dataset.maskaTokens!=null&&(e.tokens=ie(a.dataset.maskaTokens)),e},U=a=>a!==""?!!JSON.parse(a):!0,oe=a=>a.startsWith("[")&&a.endsWith("]")?J(a):a,ie=a=>{if(a.startsWith("{")&&a.endsWith("}"))return J(a);const s={};return a.split("|").forEach(e=>{const t=e.split(":");s[t[0]]={pattern:new RegExp(t[1]),optional:t[2]==="optional",multiple:t[2]==="multiple",repeated:t[2]==="repeated"}}),s};class re{constructor(s,e={}){b(this,"items",new Map),b(this,"beforeinputEvent",t=>{const n=t.target,o=this.items.get(n);o.isEager()&&"inputType"in t&&t.inputType.startsWith("delete")&&o.unmasked(n.value).length<=1&&this.setMaskedValue(n,"")}),b(this,"inputEvent",t=>{if(t instanceof CustomEvent&&t.type==="input"&&t.detail!=null&&typeof t.detail=="object"&&"masked"in t.detail)return;const n=t.target,o=this.items.get(n),u=n.value,h=n.selectionStart,c=n.selectionEnd;let v=u;if(o.isEager()){const l=o.masked(u),i=o.unmasked(u);i===""&&"data"in t&&t.data!=null?v=t.data:i!==o.unmasked(l)&&(v=i)}if(this.setMaskedValue(n,v),"inputType"in t&&(t.inputType.startsWith("delete")||h!=null&&h<u.length))try{n.setSelectionRange(h,c)}catch{}}),this.options=e,typeof s=="string"?this.init(Array.from(document.querySelectorAll(s)),this.getMaskOpts(e)):this.init("length"in s?Array.from(s):[s],this.getMaskOpts(e))}destroy(){for(const s of this.items.keys())s.removeEventListener("input",this.inputEvent),s.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(s,e){const t=this.items.get(s),n=new L(W(s,this.getMaskOpts(e)));return JSON.stringify(t.opts)!==JSON.stringify(n.opts)}needUpdateValue(s){const e=s.dataset.maskaValue;return e==null&&s.value!==""||e!=null&&e!==s.value}getMaskOpts(s){const{onMaska:e,preProcess:t,postProcess:n,...o}=s;return o}init(s,e){for(const t of s){const n=new L(W(t,e));this.items.set(t,n),t.value!==""&&this.setMaskedValue(t,t.value),t.addEventListener("input",this.inputEvent),t.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(s,e){const t=this.items.get(s);this.options.preProcess!=null&&(e=this.options.preProcess(e));const n=t.masked(e),o=t.unmasked(t.isEager()?n:e),u=t.completed(e),h={masked:n,unmasked:o,completed:u};e=n,this.options.postProcess!=null&&(e=this.options.postProcess(e)),s.value=e,s.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(c=>c(h)):this.options.onMaska(h)),s.dispatchEvent(new CustomEvent("maska",{detail:h})),s.dispatchEvent(new CustomEvent("input",{detail:h}))}}const N=new WeakMap,ue=a=>{setTimeout(()=>{var s;((s=N.get(a))==null?void 0:s.needUpdateValue(a))===!0&&a.dispatchEvent(new CustomEvent("input"))})},S=(a,s)=>{const e=a instanceof HTMLInputElement?a:a.querySelector("input"),t={...s.arg};if(e==null)return;ue(e);const n=N.get(e);if(n!=null){if(!n.needUpdateOptions(e,t))return;n.destroy()}if(s.value!=null){const o=s.value,u=h=>{o.masked=h.masked,o.unmasked=h.unmasked,o.completed=h.completed};t.onMaska=t.onMaska==null?u:Array.isArray(t.onMaska)?[...t.onMaska,u]:[t.onMaska,u]}N.set(e,new re(e,t))},de={class:"font-15 font-weight-medium"},pe={class:"font-15 font-weight-medium"},me=A("div",{class:"font-15 font-weight-medium"},"CVV",-1),he={class:"font-15 font-weight-medium"},ce={class:"text-white"},fe={__name:"CardForm",setup(a){const s=y(!1),e=y(!1),t=y({number:"",date:"",CVV:"",name:""}),n=ee(()=>t.value.number.length===19&&t.value.date.length===9&&t.value.CVV.length===3&&t.value.name.length>0),o=y({mask:"#### #### #### ####",eager:!0}),u=y({mask:l=>l.at(0)==="1"?"XZ / ####":"X# / ####",eager:!0,tokens:{X:{pattern:/[0-1]/},Z:{pattern:/[0-2]/}}}),h=y({mask:"###",eager:!0}),c=y({mask:"A A",eager:!0,tokens:{A:{pattern:/[A-Z]/,multiple:!0}}});async function v(){try{const[l,i]=t.value.date.split("/"),d={exp_month:l,exp_year:i,card_number:t.value.number.split(" ").join(""),token:t.value.CVV,card_holder:t.value.name};await H.addCard(d),s.value=!0}catch(l){console.log(l),e.value=!0}}return(l,i)=>(B(),D(x,{class:"drop-big-shadow rounded-lg"},{default:m(()=>[r(P,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=d=>e.value=d),title:l.$t("card_failed"),onCloseMe:i[1]||(i[1]=d=>l.$router.push({name:"Map"}))},null,8,["modelValue","title"]),r(P,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=d=>s.value=d),title:l.$t("card_success"),onCloseMe:i[3]||(i[3]=d=>l.$router.push({name:"Map"}))},null,8,["modelValue","title"]),r(M,null,{default:m(()=>[r(g,{class:"text-center font-weight-bold"},{default:m(()=>[te(_(l.$t("fill_info")),1)]),_:1})]),_:1}),r(M,null,{default:m(()=>[r(g,null,{default:m(()=>[A("div",de,_(l.$t("card_numb")),1),R(r(C,{variant:"outlined",placeholder:"5169 0000 0000 0000","hide-details":"",modelValue:t.value.number,"onUpdate:modelValue":i[4]||(i[4]=d=>t.value.number=d)},null,8,["modelValue"]),[[$(S),void 0,o.value]])]),_:1})]),_:1}),r(M,null,{default:m(()=>[r(g,{cols:"7"},{default:m(()=>[A("div",pe,_(l.$t("expiry_date")),1),R(r(C,{variant:"outlined",placeholder:"мм / гггг","hide-details":"",modelValue:t.value.date,"onUpdate:modelValue":i[5]||(i[5]=d=>t.value.date=d)},null,8,["modelValue"]),[[$(S),void 0,u.value]])]),_:1}),r(ae),r(g,{cols:"4"},{default:m(()=>[me,R(r(C,{type:"password",variant:"outlined",placeholder:"***","hide-details":"",modelValue:t.value.CVV,"onUpdate:modelValue":i[6]||(i[6]=d=>t.value.CVV=d)},null,8,["modelValue"]),[[$(S),void 0,h.value]])]),_:1})]),_:1}),r(M,null,{default:m(()=>[r(g,{cols:"8"},{default:m(()=>[A("div",he,_(l.$t("name")),1),R(r(C,{variant:"outlined",placeholder:"NAME FULLNAME","hide-details":"",modelValue:t.value.name,"onUpdate:modelValue":i[7]||(i[7]=d=>t.value.name=d)},null,8,["modelValue"]),[[$(S),void 0,c.value]])]),_:1})]),_:1}),r(M,null,{default:m(()=>[r(g,{class:"d-flex justify-center"},{default:m(()=>[r(q,{color:"brand",disabled:!n.value,onClick:i[8]||(i[8]=d=>v())},{default:m(()=>[A("span",ce,_(l.$t("add_card")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}},Ee={__name:"AddPaymentMethod",setup(a){return(s,e)=>(B(),D(x,null,{default:m(()=>[r(M,null,{default:m(()=>[r(g,null,{default:m(()=>[r(X,{title:s.$t("add_card"),onClicked:e[0]||(e[0]=t=>s.$router.push({name:"Map"}))},null,8,["title"])]),_:1})]),_:1}),r(M,null,{default:m(()=>[r(g,null,{default:m(()=>[r(fe)]),_:1})]),_:1})]),_:1}))}};export{Ee as default};
