import{_ as C,a3 as v,r as S,Y as G,o as A,l as m,m as E,w as n,j as r,T as O,a4 as q,R as D,N as f,M as g,P as y,V as M,K as P,a6 as b}from"./index-47b4a022.js";import{u as j}from"./search-63670d42.js";import{u as J,d as L}from"./order-65aed67f.js";import{a as U}from"./user-7a776cf7.js";import{u as F}from"./directions-c57ca3d8.js";import{o as K,e as W,g as h,h as H,f as Y}from"./VRow-06a8dd11.js";import"./useRender-5142e326.js";import"./tag-35f47c51.js";const z="https://catalog.api.2gis.com",Q=`${z}/3.0/`,I=U.create({baseURL:Q}),X="rukuvo0173",k=`&key=${X}`,w={getSuggests(c,l){return I.get(`/suggests?q=${c}&location=${l}${k}`)},getGeocode(c){return I.get(`/items/geocode?q=${c}&fields=items.point${k}`)}};const Z={class:"results-container"},ee=["onClick"],te={class:"font-weight-medium"},oe={__name:"SearchResults",setup(c){const l=F(),o=j(),i=J(),{searchWord:a}=v(o),{pointA:d,pointB:p,pointAName:$,pointBName:B}=v(i),u=S([]),V=S(JSON.parse(localStorage.getItem("qt_search_history"))||[]);G(a,()=>{o.focusInput==="A"?$.value=a.value:o.focusInput==="B"&&(B.value=a.value),x()}),A(()=>{o.showPanel=!0,o.searchWord="",document.querySelector("#searchInput").focus()});const x=L(()=>{N()},600);async function N(){let s=`${i.point.coordinates[0]},${i.point.coordinates[1]}`;try{const e=await w.getSuggests(a.value,s);u.value=e.data.result.items}catch(e){u.value=[],console.log(e)}}function _(){setTimeout(()=>{o.showPanel=!1,o.readPointer=!0,o.focusInput==="A"?(document.getElementById("firstInput").focus(),d.value={}):(document.getElementById("secondInput").focus(),p.value={}),b.push({name:"Map"}),i.debouncedRerender()},100)}async function R(s){s=window.localStorage.getItem("city")+" , "+s;try{const e=await w.getGeocode(s),t={building_id:e.data.result.items[0].id,coordinates:[e.data.result.items[0].point.lon,e.data.result.items[0].point.lat],name:e.data.result.items[0].name};o.focusInput==="A"?(d.value={...t},l.pointA={...t}):o.focusInput==="B"&&(p.value={...t},l.pointB={...t}),b.push({name:"Map"}),i.triggerCenterMap(t),Object.keys(d.value).length!==0&&Object.keys(p.value).length!==0&&l.debouncedDrawDirection()}catch(e){console.log(e)}}function T(s){let e=JSON.parse(localStorage.getItem("qt_search_history"));e?(e==null?void 0:e.length)===5&&e.pop():e=[],e=e.filter(t=>t.id!==s.id),localStorage.setItem("qt_search_history",JSON.stringify([s,...e]))}return(s,e)=>(m(),E(K,{class:"search-results"},{default:n(()=>[r(h,null,{default:n(()=>[r(W,{class:"bg-white search-panel mt-5",variant:"outlined","hide-details":"","prepend-inner-icon":"mdi-map-marker",modelValue:O(a),"onUpdate:modelValue":e[0]||(e[0]=t=>q(a)?a.value=t:null),id:"searchInput",onBlur:e[1]||(e[1]=t=>_())},null,8,["modelValue"])]),_:1}),r(h,null,{default:n(()=>[r(H,{variant:"text","prepend-icon":"mdi-flag-triangle text-black",class:"text-brand pb-0 font-weight-bold",onClick:e[2]||(e[2]=t=>_())},{default:n(()=>[D(f(s.$t("choose_location")),1)]),_:1})]),_:1}),r(h,null,{default:n(()=>[r(Y,null,{default:n(()=>[g("div",Z,[(m(!0),y(P,null,M(u.value.length>0?u.value:V.value,t=>(m(),y("div",{key:t.id,onClick:se=>{T(t),R(`Алматы, ${t.address_name}`)},class:"mb-3 result-item"},[g("div",te,f(t.name),1),g("div",null,f(t.address_name),1)],8,ee))),128))])]),_:1})]),_:1})]),_:1}))}},pe=C(oe,[["__scopeId","data-v-c40bfd54"]]);export{pe as default};
