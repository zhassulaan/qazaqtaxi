import{t as oe,r as x,_ as T,a3 as z,Y as M,l as g,P as y,j as e,o as K,w as o,R as U,N as s,M as r,K as I,L as re,T as V,m as P,V as Z,D as E,Q as L,c as q,U as A,a8 as ne}from"./index-47b4a022.js";import{u as j}from"./order-65aed67f.js";import{u as R}from"./userPanel-b5620d02.js";import{A as w,a as se}from"./user-7a776cf7.js";import{l as le,d as ie,L as de}from"./directions-2b84729d.js";import{a as F,C as ce,V as ue,b as fe}from"./ClientPanel-f526dfda.js";import{f as _,g as m,h as $,V as G,o as _e}from"./VRow-06a8dd11.js";import{_ as pe}from"./HeaderRouter-2e3b5674.js";import"./useRender-5142e326.js";import"./_commonjsHelpers-725317a4.js";import"./tag-35f47c51.js";const W=oe("driverData",()=>{const a=x({}),t=x({});function i(){navigator.geolocation.getCurrentPosition(f,n)}function f(l){t.value.longitude=l.coords.longitude,t.value.latitude=l.coords.latitude}function n(){console.log("errorGeo")}return{info:a,point:t,updatePoint:i}},{persist:!0}),b="/driver",N={getDriverData(){return w.post(`${b}/driverData`)},getVehicleData(a){return w.post(`${b}/slider-data`,{player_id:a})},startWork(a){return w.post(`${b}/online-offline`,{longitude:a.longitude,latitude:a.latitude,status:1})},stopWork(a){return w.post(`${b}/online-offline`,{longitude:a.longitude,latitude:a.latitude,status:2})},getNewOrder(a){return w.post(`${b}/cars`,a)},acceptNewOrder(a){return w.post(`${b}/booking-order-accept-reject`,a)},getOrderInfo(a){return w.post(`${b}/booking-order-info`,a)},arrivedAtPickUp(a){return w.post(`${b}/arrived-at-pickup`,a)},startOrder(a){return w.post(`${b}/booking-order-picked`,a)},finishOrder(a){return w.post(`${b}/booking/end`,a)},rateOrder(a){return w.post(`${b}/complete-booking-order`,a)},cancelOrder(a){return w.post(`${b}/booking-order-accept-reject`,a)}};const ve={class:"map",id:"map"},ge="896f3963-4c91-4ce7-9a61-6f91f3ff7ebd",H="896f3963-4c91-4ce7-9a61-6f91f3ff7ebd",me=`
    <div class="buttonRoot" id="find-me">
        <button class="button">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 32 32"
            >
                <path
                    fill="black"
                    d="M17.89 26.27l-2.7-9.46-9.46-2.7 18.92-6.76zm-5.62-12.38l4.54 1.3 1.3 4.54 3.24-9.08z"
                />
            </svg>
        </button>
    </div>
    <style>
    svg{
        background-color: white;
        border-radius: 5px
    }
    </style>
`,he={__name:"DriverMap",props:["test"],setup(a){const t=j(),{drawDirection:i,rerenderMap:f,clearDirection:n,centerMap:l}=z(t);let d;function c(u,h){se.post("https://routing.api.2gis.com/carrouting/6.0.0/global?key="+H,{type:"jam",points:[{type:"walking",x:u[0],y:u[1]},{type:"walking",x:h[0],y:h[1]}]}).then(S=>{var v,D;console.log("ok"),console.log((v=S.data)==null?void 0:v.result[0].total_duration),console.log((D=S.data)==null?void 0:D.result[0].total_distance)})}return le().then(u=>{let h=[76.9351982,43.2516761],S=12;const v=new u.Map("map",{center:h,zoom:S,key:ge,zoomControl:!1}),D=new ie.Directions(v,{directionsApiKey:H});M(i,()=>{p(t.pointA.coordinates,t.pointB.coordinates)}),M(n,()=>{O()});function p(C,k){D.carRoute({points:[C,k]}),v.setCenter(k),v.setZoom(13.5),c(C,k)}function O(){D.clear()}M(f,()=>{Y()});async function Y(){await X(50),v.invalidateSize()}new u.Control(v,me,{position:"centerRight"}).getContainer().querySelector("#find-me").addEventListener("click",J);function J(){navigator.geolocation.getCurrentPosition(ae,B)}function X(C){return new Promise(k=>setTimeout(k,C))}function ee(){navigator.geolocation.getCurrentPosition(te,B)}function te(C){let k=[C.coords.longitude,C.coords.latitude];d&&d.destroy(),d=new u.CircleMarker(v,{coordinates:k,radius:14,color:"#0088ff",strokeWidth:4,strokeColor:"#ffffff",stroke2Width:6,stroke2Color:"#0088ff55"}),!t.centerMap&&!t.drawDirection&&(console.log("sex"),v.setCenter(k),v.setZoom(16))}function ae(C){let k=[C.coords.longitude,C.coords.latitude];d&&d.destroy(),d=new u.CircleMarker(v,{coordinates:k,radius:14,color:"#0088ff",strokeWidth:4,strokeColor:"#ffffff",stroke2Width:6,stroke2Color:"#0088ff55"}),v.setCenter(k),v.setZoom(16)}function B(){console.log("error")}ee()}),(u,h)=>(g(),y("div",ve,[e(de)]))}},we=T(he,[["__scopeId","data-v-ae6a3dc3"]]),be={};function ye(a,t){return g(),y("div")}const ke=T(be,[["render",ye]]),$e={class:"text-white"},xe={__name:"DriverReadyInterface",setup(a){const t=W(),i=j(),f=R();K(()=>{t.updatePoint()});async function n(){try{await N.stopWork(t.point),i.showLoader=!1,f.mode="driver-stand-by"}catch(l){console.log(l)}}return(l,d)=>(g(),y(I,null,[e(m,null,{default:o(()=>[e(_,{class:"text-center py-0"},{default:o(()=>[U(s(l.$t("wait")),1)]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{cols:"3"},{default:o(()=>[e($,{class:"rounded-lg bg-blackish font-weight-bold",block:"",height:"60",icon:"mdi-close-thick text-white",onClick:d[0]||(d[0]=c=>n())})]),_:1}),e(_,null,{default:o(()=>[e($,{class:"rounded-lg bg-brand font-weight-bold text-white",block:"",height:"60",disabled:""},{default:o(()=>[r("span",$e,s(l.$t("order_wait")),1)]),_:1})]),_:1})]),_:1})],64))}},Ce={class:"d-flex flex-row justify-space-between align-start drop-big-shadow pa-2 rounded-lg",style:{"line-height":"1.1em"}},De={class:"d-flex flex-column justify-start align-center font-weight-medium"},Se={class:"font-weight-bold text-brand"},Ie={class:"d-flex flex-column justify-start align-center font-weight-medium"},Me={class:"font-weight-bold text-brand"},Ve={class:"d-flex flex-column justify-start align-center"},Re={class:"font-weight-medium"},Ne={class:"font-weight-bold text-brand"},Te={style:{"border-top":"1px solid black"}},ze={__name:"RequestCard",props:["data"],setup(a){const t=a,i=re();function f(n){switch(n){case"cash":return i.t("cash");case"card":return i.t("card");default:return""}}return(n,l)=>(g(),y("div",Ce,[r("div",De,[r("div",null,s(n.$t("distance")),1),r("div",Se,s(t.data.distance)+" "+s(n.$t("km")),1)]),r("div",Ie,[r("div",null,s(n.$t("duration").split(" ")[0]),1),r("div",Me,s(t.data.time)+" "+s(n.$t("min")),1)]),r("div",Ve,[r("div",Re,s(n.$t("payment")),1),r("div",Ne,s(t.data.price)+" "+s(n.$t("t")),1),r("div",Te,s(f(t.data.payment)),1)])]))}},je={class:"pa-2 rounded-lg drop-big-shadow"},Pe={class:"font-weight-bold"},Ge={class:"font-weight-medium"},Q={__name:"WayCard",props:["data"],setup(a){const t=a;return(i,f)=>(g(),y("div",je,[r("div",Pe,s(t.data.title),1),r("div",Ge,[e(G,{icon:"mdi-circle-outline text-red",size:"small"}),U(" "+s(t.data.target),1)])]))}},We={class:"text-white"},Oe={__name:"DriverRequestInterface",setup(a){const t=R(),{mode:i}=z(t);x(!1),x("waiting");const f=x("60");function n(){i.value==="driver-ready"&&(i.value="driver-stand-by")}function l(){}return(d,c)=>(g(),y(I,null,[e(m,null,{default:o(()=>[e(_,{class:"text-center py-0"},{default:o(()=>[r("div",null,s(d.$t("accept"))+" "+s(f.value),1)]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,null,{default:o(()=>[e(ze,{data:{distance:"0.2",time:"7",price:"400",payment:"cash"}})]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{class:"pt-0"},{default:o(()=>[e(Q,{data:{title:d.$t("departure"),target:"улица Мауленова, 92"}},null,8,["data"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{cols:"3"},{default:o(()=>[e($,{class:"rounded-lg bg-blackish font-weight-bold",block:"",height:"60",icon:"mdi-close-thick text-white",onClick:c[0]||(c[0]=u=>n())})]),_:1}),e(_,null,{default:o(()=>[e($,{class:"rounded-lg bg-brand font-weight-bold text-white",block:"",height:"60",disabled:V(i)==="driver-ready",onClick:c[1]||(c[1]=u=>void 0)},{default:o(()=>[r("span",We,s(d.$t("accept_order")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})],64))}};const Be={class:"font-15 font-weight-medium pl-2",style:{"line-height":"1.1em"}},Ee={class:"rounded-lg bg-white pa-1",style:{width:"fit-content"}},Le={class:"nowrap"},qe=["src"],Ae={class:"font-weight-medium"},He={__name:"DriverCard",props:["data"],setup(a){const t=a;return(i,f)=>(g(),P(_e,null,{default:o(()=>[e(m,{class:"rounded-lg drop-big-shadow"},{default:o(()=>[e(_,{class:"d-flex flex-row justify-start align-center pa-2 bg-brand rounded-lg"},{default:o(()=>[e(F,{color:"graydarker",size:"large"}),r("div",Be,[r("div",null,s(t.data.firstName),1),r("div",null,s(t.data.lastName),1),r("div",Ee," ID "+s(t.data.id),1),r("div",Le,[(g(),y(I,null,Z(5,n=>e(G,{key:n,size:"small",icon:"mdi-star"})),64))])])]),_:1}),e(_,{class:"bg-white rounded-lg d-flex flex-row justify-start align-center font-15 pa-2"},{default:o(()=>[r("img",{src:t.data.image,class:"mr-2 car-img rounded-lg"},null,8,qe),r("div",null,[r("div",Ae,s(t.data.carModel),1),r("div",null,s(t.data.carNumber),1)])]),_:1})]),_:1})]),_:1}))}},Ke=T(He,[["__scopeId","data-v-2dd7f662"]]),Ue={class:"text-white"},Ze={__name:"DriverStandByInterface",setup(a){const t=W(),i=j(),f=R(),n=x(!1);async function l(){try{await N.startWork(t.point),f.mode="driver-ready",i.showLoader=!0}catch(c){console.log(c),n.value=!0}}function d(){}return(c,u)=>(g(),y(I,null,[e(pe,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=h=>n.value=h),title:c.$t("failed_work"),onCloseMe:u[1]||(u[1]=h=>n.value=!1)},null,8,["modelValue","title"]),e(m,null,{default:o(()=>[e(_,null,{default:o(()=>[e(Ke,{data:V(t).info},null,8,["data"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{cols:"3"},{default:o(()=>[e($,{class:"rounded-lg bg-brand font-weight-bold",block:"",height:"60",icon:"mdi-card-bulleted-outline text-white",onClick:u[2]||(u[2]=h=>void 0)})]),_:1}),e(_,null,{default:o(()=>[e($,{class:"rounded-lg bg-brand font-weight-bold text-white",block:"",height:"60",onClick:u[3]||(u[3]=h=>l())},{default:o(()=>[r("span",Ue,s(c.$t("start_work")),1)]),_:1})]),_:1})]),_:1})],64))}},Fe={class:"drop-big-shadow pa-2 rounded-lg",style:{"line-height":"1.1em"}},Qe={class:"font-weight-bold mb-2"},Ye={class:"d-flex flex-row justify-space-between font-15"},Je={class:"d-flex flex-row justify-start align-center"},Xe={class:"font-weight-medium"},et={class:"nowrap"},tt={__name:"ClientCard",props:["data"],setup(a){const t=a;return(i,f)=>(g(),y("div",Fe,[r("div",Qe,s(i.$t("passenger_info")),1),r("div",Ye,[r("div",Je,[e(F,{color:"graydarker",class:"mr-2"}),r("div",Xe,[r("div",null,s(t.data.firstName),1),r("div",null,s(t.data.lastName),1)])]),r("div",null,[r("div",null,s(t.data.phone),1),r("div",et,[(g(!0),y(I,null,Z(t.data.stat,n=>(g(),P(G,{key:n,icon:"mdi-star",size:"small"}))),128))])])])]))}},at={__name:"DriverToInterface",setup(a){const t=R(),{mode:i}=z(t);x("waiting");function f(){i.value==="driver-ready"&&(i.value="driver-stand-by")}function n(){}return(l,d)=>(g(),y(I,null,[e(m,null,{default:o(()=>[e(_,{class:"d-flex flex-row justify-space-between align-center py-0"},{default:o(()=>[r("div",null,s(l.$t("duration"))+" ~7"+s(l.$t("min")),1),r("div",null,[e($,{size:"small",icon:"mdi-phone",class:"mr-3"}),e($,{size:"small",icon:"mdi-message",class:"mr-3"}),e($,{size:"small",icon:"mdi-alert"})])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,null,{default:o(()=>[e(tt,{data:{firstName:"Имя",lastName:"Фамилия",phone:"+7 707 777 7777",stat:5}})]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{class:"pt-0"},{default:o(()=>[e(Q,{data:{title:l.$t("departure"),target:"улица Мауленова, 92"}},null,8,["data"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(_,{cols:"3"},{default:o(()=>[e($,{class:"rounded-lg bg-blackish font-weight-bold",block:"",height:"60",icon:"mdi-close-thick text-white",onClick:d[0]||(d[0]=c=>f())})]),_:1}),e(_,null,{default:o(()=>[e($,{class:"rounded-lg bg-brand font-weight-bold text-white",block:"",height:"60",disabled:V(i)==="driver-ready",onClick:d[1]||(d[1]=c=>void 0)},{default:o(()=>[E(r("span",{class:"text-white"},s(l.$t("arrived")),513),[[L,V(i)==="driver-to-client"]]),E(r("span",{class:"text-white"},s(l.$t("complete_order")),513),[[L,V(i)==="driver-to-goal"]])]),_:1},8,["disabled"])]),_:1})]),_:1})],64))}};const ot={__name:"MainMap",setup(a){const t=W(),i=j(),f=R(),{mode:n}=z(f),l=x(230),d=x(.85),c=x(""),u=x(!0),h={ChatInterface:fe,DriverCheckInterface:ke,DriverReadyInterface:xe,DriverRequestInterface:Oe,DriverStandByInterface:Ze,DriverToInterface:at},S=q(()=>u.value?`calc(100vh - ${l.value}px + 40px)`:"calc(100vh + 20px)");q(()=>u.value?0:-l.value*d.value),K(()=>{t.updatePoint(),v(),D()});async function v(){try{const p=await N.getDriverData();console.log(p),t.info.firstName=p.data.data.first_name,t.info.lastName=p.data.data.last_name,t.info.rating=p.data.data.rating,t.info.color=p.data.data.DriverVehicle[0].vehicle_color}catch(p){console.log(p)}}async function D(){try{const p=await N.getVehicleData(localStorage.getItem("token"));t.info.image=p.data.data.work_set.image,t.info.id=p.data.data.work_set.driver_vehicle_id,t.info.carModel=p.data.data.work_set.vehicle_detail.split("(")[0],t.info.carNumber=p.data.data.work_set.vehicle_detail.split("(")[1].slice(0,-1)}catch(p){console.log(p)}}return M(u,()=>{i.debouncedRerender()}),n.value="driver-stand-by",M(n,()=>{d.value=.85,l.value=230,n.value==="chat"&&(l.value=365,c.value="ChatInterface"),n.value==="driver-check"&&(l.value=500,c.value="CheckInterface"),n.value==="driver-stand-by"&&(l.value=260,c.value="DriverStandByInterface"),n.value==="driver-ready"&&(l.value=160,d.value=.75,c.value="DriverReadyInterface"),n.value==="driver-request"&&(l.value=330,d.value=.88,c.value="DriverRequestInterface"),n.value==="driver-to-client"&&(d.value=.89,l.value=350,c.value="DriverToInterface"),n.value==="driver-to-goal"&&(d.value=.89,l.value=350,c.value="DriverToInterface"),i.debouncedRerender()},{immediate:!0}),(p,O)=>(g(),y("div",null,[e(we,{class:"map",style:A({height:S.value})},null,8,["style"]),e(ce,{class:"bottom-panel",style:A({height:`${l.value}px`})},{toggler:o(()=>[e(ue,{class:"bg-graydark rounded-lg toggler",width:"50",height:"5"})]),content:o(()=>[(g(),P(ne(h[c.value])))]),_:1},8,["style"])]))}},gt=T(ot,[["__scopeId","data-v-ad55f621"]]);export{gt as default};
